<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.Rectangle?>
<?import java.net.URL?>
<VBox xmlns="http://javafx.com/javafx/11.0.1"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.yuzj.autolink.plc.control.MainControl"
      spacing="10"
      style="-fx-padding: 10; -fx-background-color: #f4f4f4;" VBox.vgrow="ALWAYS">

    <!-- 标题栏 -->
    <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-background-color: #2c3e50; -fx-padding: 10;">
        <Rectangle width="30" height="30" fill="#3498db" arcWidth="10" arcHeight="10"/>
        <Label text="PLC 上位机控制系统" style="-fx-text-fill: white; -fx-font-size: 18px; -fx-font-weight: bold;"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Label fx:id="connectionStatus" text="未连接" style="-fx-text-fill: #e74c3c; -fx-font-weight: bold;"/>
    </HBox>

    <!-- 连接控制区域 -->
    <VBox style="-fx-padding: 15; -fx-background-color: white; -fx-background-radius: 5; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 0);">
        <Label text="PLC 连接设置" style="-fx-font-weight: bold; -fx-text-fill: #2c3e50; -fx-font-size: 16px;"/>
        <Separator style="-fx-padding: 5 0;"/>

        <HBox spacing="15" style="-fx-padding: 15 0 5 0;">
            <!-- 连接设置控件 -->
            <HBox spacing="8" alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                <Label text="协议:" style="-fx-alignment: center-right;"/>
                <ComboBox fx:id="protocolCombo" prefWidth="90"/>

                <Label text="IP:" style="-fx-alignment: center-right; -fx-padding: 0 0 0 5;"/>
                <TextField fx:id="hostField" text="localhost" prefWidth="110"/>

                <Label text="端口:" style="-fx-alignment: center-right; -fx-padding: 0 0 0 5;"/>
                <TextField fx:id="portField" text="102" prefWidth="55"/>

                <Label text="机架:" style="-fx-alignment: center-right; -fx-padding: 0 0 0 5;"/>
                <TextField fx:id="rackField" text="0" prefWidth="35"/>

                <Label text="槽号:" style="-fx-alignment: center-right; -fx-padding: 0 0 0 5;"/>
                <TextField fx:id="slotField" text="1" prefWidth="35"/>

                <Label text="超时:" style="-fx-alignment: center-right; -fx-padding: 0 0 0 5;"/>
                <TextField fx:id="timeoutField" text="5000" prefWidth="55"/>
            </HBox>

            <!-- 操作按钮区域 -->
            <HBox spacing="10" alignment="CENTER_LEFT">
                <Button fx:id="connectButton" text="连接" onAction="#handleConnect"
                        style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 6 15; -fx-background-radius: 4;"/>
                <Button fx:id="disconnectButton" text="断开" onAction="#handleDisconnect" disable="true"
                        style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 6 15; -fx-background-radius: 4;"/>
                <Button text="测试" onAction="#handleTestConnection"
                        style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 6 15; -fx-background-radius: 4;"/>
            </HBox>
        </HBox>
    </VBox>

    <!-- 主要内容区域 -->
    <VBox VBox.vgrow="ALWAYS">
        <SplitPane dividerPositions="0.5" VBox.vgrow="ALWAYS">
            <!-- 左侧：数据表格 -->
            <VBox spacing="5" style="-fx-padding: 10; -fx-background-color: white; -fx-background-radius: 5;">
                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Label text="实时数据监控" style="-fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button text="添加监控点" onAction="#handleAddTag"/>
                    <Button text="清除数据" onAction="#handleClearData"/>
                </HBox>

                <TableView fx:id="dataTable" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn text="产品名" prefWidth="120" resizable="false"/>
                        <TableColumn text="地址" prefWidth="120" resizable="false"/>
                        <TableColumn text="值" prefWidth="100" resizable="false"/>
                        <TableColumn text="数据类型" prefWidth="100" resizable="false"/>
                        <TableColumn text="质量" prefWidth="60" resizable="false"/>
                        <TableColumn text="时间戳" prefWidth="150"/>
                    </columns>
                </TableView>

                <HBox spacing="10" alignment="CENTER_RIGHT">
                    <Label text="刷新间隔(ms):"/>
                    <TextField fx:id="refreshIntervalField" text="100" prefWidth="60"/>
                    <Button text="应用" onAction="#handleApplyRefreshInterval"/>
                    <ToggleButton fx:id="autoRefreshToggle" text="自动刷新" selected="true"/>
                </HBox>
            </VBox>

            <!-- 右侧：图表和详细数据 -->
            <SplitPane dividerPositions="0.66" orientation="VERTICAL" VBox.vgrow="ALWAYS">
                <!-- 图表区域 (占2/3) -->
                <VBox spacing="5" style="-fx-padding: 10; -fx-background-color: white; -fx-background-radius: 5;">
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="数据趋势图" style="-fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <ComboBox fx:id="chartTagSelector" promptText="选择监控点" prefWidth="150"/>
                        <Button text="添加图表" onAction="#handleAddChart"/>
                        <Button text="清除图表" onAction="#handleClearChart"/>
                    </HBox>

                    <LineChart fx:id="dataChart" VBox.vgrow="ALWAYS">
                        <xAxis>
                            <NumberAxis label="时间 (s)" forceZeroInRange="false"/>
                        </xAxis>
                        <yAxis>
                            <NumberAxis label="数值" forceZeroInRange="false"/>
                        </yAxis>
                    </LineChart>
                </VBox>

                <!-- 详细数据和控制区域 (占1/3) -->
                <TabPane tabClosingPolicy="UNAVAILABLE">
                    <Tab text="读写操作">
                        <VBox spacing="10" style="-fx-padding: 10;">
                            <GridPane hgap="10" vgap="10">
                                <columnConstraints>
                                    <ColumnConstraints percentWidth="20"/>
                                    <ColumnConstraints percentWidth="50"/>
                                    <ColumnConstraints percentWidth="30"/>
                                </columnConstraints>

                                <Label text="地址:"/>
                                <TextField fx:id="readWriteAddressField" GridPane.columnIndex="1"/>
                                <Button text="读取" onAction="#handleRead" GridPane.columnIndex="2"/>

                                <Label text="值:" GridPane.rowIndex="1"/>
                                <TextField fx:id="readWriteValueField" GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                                <Button text="写入" onAction="#handleWrite" GridPane.rowIndex="1"
                                        GridPane.columnIndex="2"/>

                                <Label text="数据类型:" GridPane.rowIndex="2"/>
                                <ComboBox fx:id="dataTypeCombo" GridPane.rowIndex="2" GridPane.columnIndex="1"/>
                                <Region GridPane.rowIndex="2" GridPane.columnIndex="2"/>
                            </GridPane>

                            <TextArea fx:id="logArea" prefRowCount="5" style="-fx-font-family: monospace;"
                                      editable="false" focusTraversable="false" VBox.vgrow="ALWAYS"/>
                        </VBox>
                    </Tab>

                    <Tab text="报警管理">
                        <VBox spacing="10" style="-fx-padding: 10;">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="系统报警" style="-fx-font-weight: bold;"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="确认报警" onAction="#handleAcknowledgeAlarms"/>
                                <Button text="清除历史" onAction="#handleClearAlarms"/>
                            </HBox>

                            <TableView fx:id="alarmTable" VBox.vgrow="ALWAYS">
                                <columns>
                                    <TableColumn text="时间" prefWidth="150" fx:id="time"/>
                                    <TableColumn text="类型" prefWidth="100" fx:id="alarmTypeColumn"/>
                                    <TableColumn text="状态" prefWidth="90" fx:id="alarmStatusColumn"/>
                                    <TableColumn text="描述" prefWidth="250" fx:id="alarmDescColumn"/>
                                </columns>
                            </TableView>
                        </VBox>
                    </Tab>

                    <Tab text="系统管理">
                        <VBox spacing="10" style="-fx-padding: 10;">
                            <Label text="PLC 产品配置" style="-fx-font-weight: bold;"/>

                            <HBox spacing="10">
                                <Button text="导入配置" onAction="#handleImportConfig"/>
                                <Button text="导出配置" onAction="#handleExportConfig"/>
                                <Button text="保存配置" onAction="#handleSaveConfig"/>
                                <Button text="加载配置" onAction="#handleLoadConfig"/>
                            </HBox>

                            <TableView fx:id="configTable" VBox.vgrow="ALWAYS">
                                <columns>
                                    <TableColumn text="名称" prefWidth="120"/>
                                    <TableColumn text="地址" prefWidth="100"/>
                                    <TableColumn text="数据类型" prefWidth="100"/>
                                    <TableColumn text="描述" prefWidth="200"/>
                                </columns>
                            </TableView>
                        </VBox>
                    </Tab>
                </TabPane>
            </SplitPane>
        </SplitPane>
    </VBox>

    <!-- 状态栏 -->
    <HBox spacing="10" style="-fx-padding: 5; -fx-background-color: #ecf0f1;">
        <Label text="就绪" fx:id="statusLabel"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Label text="数据点数:"/>
        <Label fx:id="dataPointCountLabel" text="0"/>
        <Label text="通信延迟:"/>
        <Label fx:id="latencyLabel" text="0 ms"/>
    </HBox>

    <stylesheets>
        <URL value="@/static/styles/main.css"/>
    </stylesheets>
</VBox>
